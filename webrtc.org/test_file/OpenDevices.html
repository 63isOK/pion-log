<html>

<head>
  <title>我的第一个 HTML 页面</title>
</head>

<body>
  <p>body 元素的内容会显示在浏览器中。</p>
  <p>title 元素的内容会显示在浏览器的标题栏中。</p>
</body>

<script>

  // query devices
  async function queryDevices(type) {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.filter(device => device.kind === type)
  }

  console.log('cameras found:', queryDevices('videoinput'))
  console.log('mic found:', queryDevices('audioinput'))

  // NOTE: promise写法
  // navigator.mediaDevices.enumerateDevices()
  //   .then(function (devices) {
  //     devices.forEach(function (device) {
  //       console.log(device.kind + ":" + device.label + " id=" + device.deviceId);
  //     });
  //   })
  //   .catch(function (err) {
  //     console.log(err.name + ":" + err.message);
  //   });

  // open divices

  const openDevices = async (constraints) => {
    return await navigator.mediaDevices.getUserMedia(constraints);
  }

  try {

    const stream = openDevices({
      'video': true,
      'audio': true
    });

    console.log('got MediaStream', stream);

  } catch (error) {

    console.error('error accessing media devices.', error);
  }
</script>

</html>